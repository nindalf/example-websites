<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width" /><meta charSet="utf-8" /><link rel="icon" href="/favicon.ico" /><title>Setting up this blog</title><meta name="charset" content="utf-8" /><meta name="author" content="Krishna Sundarram" /><meta name="description" content="Krishna&#x27;s personal blog" /><link href="https://blog.nindalf.com/index.xml" rel="alternate" type="application/rss+xml" title="Krishna&#x27;s personal blog" /><meta name="next-head-count" content="8" /><link rel="preload" href="/_next/static/css/37c6e985df8853b529b3.css" as="style" /><link rel="stylesheet" href="/_next/static/css/37c6e985df8853b529b3.css" data-n-g="" /><link rel="preload" href="/_next/static/css/740b20632ac80250c7f0.css" as="style" /><link rel="stylesheet" href="/_next/static/css/740b20632ac80250c7f0.css" data-n-p="" /><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/webpack-18c200bfa4628d9da94c.js" as="script" /><link rel="preload" href="/_next/static/chunks/framework-5e33f488d9410ce9ba9d.js" as="script" /><link rel="preload" href="/_next/static/chunks/597-e9cbf8ad4e8557f256b3.js" as="script" /><link rel="preload" href="/_next/static/chunks/778-c9e86f308cd9cb372f22.js" as="script" /><link rel="preload" href="/_next/static/chunks/main-9ca82ec4d4aca520c43d.js" as="script" /><link rel="preload" href="/_next/static/chunks/pages/_app-33eebf5131cfd5d17810.js" as="script" /><link rel="preload" href="/_next/static/chunks/941-89b1c2f25315e4a44edb.js" as="script" /><link rel="preload" href="/_next/static/chunks/pages/posts/%5Bid%5D-4aeed08a217f27d1079a.js" as="script" /></head><body><div id="__next"><div><header class="utils_header__1rqd-"><ul class="utils_headingLg__de7p0"><li class="utils_headingLg__de7p0"><a href="/about/">About</a></li><li class="utils_headingLg__de7p0"><a href="/">Home</a></li></ul></header><main><article><h1>Setting up this blog</h1><div class="utils_lightText__12Ckm"><time dateTime="2019-01-09">January 9, 2019</time> <div>2<!-- --> min read</div></div><div><p>This blog is generated by <strong>hugo</strong>, a static site generator. My flow is to write it <strong>markdown</strong> files on my laptop, commit it to a <strong>git repository</strong> and push it to the machine that's hosting the blog you're reading. Once the push is successful, a <strong>post-commit hook</strong> runs hugo and generates HTML pages. <strong>Nginx</strong> serves these pages.</p>
<p>Next, the <strong>firewall</strong> needs to be configured and optionally, SSL certificates can be provisioned using <strong>Let's Encrypt</strong>. It's so much better with the pretty green lock icon.</p>
<p>The performance of this site is great because nginx does a great job at serving files. Maintenance is hassle free because git and nginx are stable and all traffic being served is static.</p>
<p>The downtime I experienced is when I botched an OS upgrade that wasn't necessary in the first place.</p>
<ol>
<li>Create/update DNS records for your domain</li>
<li>Install hugo on prod.
<ul>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="f5879a9a81b585879a91">[email&#160;protected]</a> $ wget</code> the latest release from <a href="https://github.com/gohugoio/hugo/releases">here</a>, Linux x64</li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="88fae7e7fcc8f8fae7ec">[email&#160;protected]</a> $ tar -xvzf hugo.tar</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="087a67677c48787a676c">[email&#160;protected]</a> $ mv hugo /usr/bin</code></li>
</ul>
</li>
<li>Set up git server
<ul>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="8ffde0e0fbcffffde0eb">[email&#160;protected]</a> $ mkdir blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="96e4f9f9e2d6e6e4f9f2">[email&#160;protected]</a> $ cd blog.git &#x26;&#x26; git init --bare</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="147f667d677c7a75676654797664">[email&#160;protected]</a> $ git clone <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dbbcb2af9bbcb2afb7bab9f5b8b4b6">[email&#160;protected]</a>:nindalf/blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dbb0a9b2a8b3b5baa8a99bb6b9ab">[email&#160;protected]</a> $ cd blog</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="5a3128332932343b29281a37382a">[email&#160;protected]</a> $ git remote add vps <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9be9f4f4efdbaaafaab5afa3b5a3a8b5aaaaaa">[email&#160;protected]</a>:blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="90fbe2f9e3f8fef1e3e2d0fdf2e0">[email&#160;protected]</a> $ git remote add all <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="4a2d233e0a2d233e262b2864292527">[email&#160;protected]</a>:nindalf/blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a7ccd5ced4cfc9c6d4d5e7cac5d7">[email&#160;protected]</a> $ git remote set-url --add --push all <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="95e7fafae1d5a4a1a4bba1adbbada6bba4a4a4">[email&#160;protected]</a>:blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e8839a819b8086899b9aa8858a98">[email&#160;protected]</a> $ git remote set-url --add --push all <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c0a7a9b480a7a9b4aca1a2eea3afad">[email&#160;protected]</a>:nindalf/blog.git</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="751e071c061d1b14060735181705">[email&#160;protected]</a> $ git push all</code></li>
</ul>
</li>
<li>Pull Git on server
<ul>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="c4b6ababb084b4b6aba0">[email&#160;protected]</a> $ git clone /root/blog.git/</code></li>
</ul>
</li>
<li>Set up post receive hook
<ul>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="9fedf0f0ebdfefedf0fb">[email&#160;protected]</a> $ cd /root/blog.git/hooks</code></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="32405d5d467242405d56">[email&#160;protected]</a> $ vim post-receive</code> and paste in the contents from <a href="https://gist.github.com/nindalf/93a65fba4edbd04300cb318b707357da#file-post-receive">here</a></li>
<li><code><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="a0d2cfcfd4e0d0d2cfc4">[email&#160;protected]</a> $ bash post-receive</code> - test that it's working correctly and generating the right output in the right folder</li>
</ul>
</li>
<li>Set up ufw.
<ul>
<li><code>ufw default deny incoming</code></li>
<li><code>ufw default allow outgoing</code></li>
<li><code>ufw allow ssh</code></li>
<li><code>ufw allow 'Nginx Full'</code></li>
<li><code>ufw enable</code></li>
<li><code>ufw status</code></li>
<li>Check result is identical to <a href="https://gist.github.com/nindalf/93a65fba4edbd04300cb318b707357da#file-nginx-config-result-txt">this</a></li>
</ul>
</li>
<li>Set up nginx.
<ul>
<li><code>apt-get install nginx</code></li>
<li><code>vim /etc/nginx/sites-available/default</code></li>
<li><code>server_name blog.nindalf.com nindalf.com www.nindalf.com</code></li>
</ul>
</li>
<li>Set up certificates
<ul>
<li><code>add-apt-repository ppa:certbot/certbot</code></li>
<li><code>apt-get update</code></li>
<li><code>apt-get install python-certbot-nginx</code></li>
<li><code>certbot --nginx -d blog.nindalf.com -d nindalf.com -d www.nindalf.com</code></li>
<li>Follow interactive tutorial</li>
</ul>
</li>
</ol>
<hr>
<h2>More context</h2>
<ul>
<li>Steps 1-4: <a href="https://www.digitalocean.com/community/tutorials/how-to-deploy-a-hugo-site-to-production-with-git-hooks-on-ubuntu-14-04">link</a></li>
<li>Step 5: <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-16-04">link</a></li>
<li>Step 6-7: <a href="https://www.digitalocean.com/community/tutorials/how-to-set-up-let-s-encrypt-with-nginx-server-blocks-on-ubuntu-16-04">link</a></li>
</ul>
<p>Shoutout to the great tutorials on DigitalOcean!</p>
</div></article></main><div class="utils_backToHome__2ednK"><a href="/">‚Üê Home</a></div></div></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"postData":{"id":"setting-up-this-blog","wordCount":355,"timeToRead":2,"contentHtml":"\u003cp\u003eThis blog is generated by \u003cstrong\u003ehugo\u003c/strong\u003e, a static site generator. My flow is to write it \u003cstrong\u003emarkdown\u003c/strong\u003e files on my laptop, commit it to a \u003cstrong\u003egit repository\u003c/strong\u003e and push it to the machine that's hosting the blog you're reading. Once the push is successful, a \u003cstrong\u003epost-commit hook\u003c/strong\u003e runs hugo and generates HTML pages. \u003cstrong\u003eNginx\u003c/strong\u003e serves these pages.\u003c/p\u003e\n\u003cp\u003eNext, the \u003cstrong\u003efirewall\u003c/strong\u003e needs to be configured and optionally, SSL certificates can be provisioned using \u003cstrong\u003eLet's Encrypt\u003c/strong\u003e. It's so much better with the pretty green lock icon.\u003c/p\u003e\n\u003cp\u003eThe performance of this site is great because nginx does a great job at serving files. Maintenance is hassle free because git and nginx are stable and all traffic being served is static.\u003c/p\u003e\n\u003cp\u003eThe downtime I experienced is when I botched an OS upgrade that wasn't necessary in the first place.\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eCreate/update DNS records for your domain\u003c/li\u003e\n\u003cli\u003eInstall hugo on prod.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ wget\u003c/code\u003e the latest release from \u003ca href=\"https://github.com/gohugoio/hugo/releases\"\u003ehere\u003c/a\u003e, Linux x64\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ tar -xvzf hugo.tar\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ mv hugo /usr/bin\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSet up git server\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ mkdir blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ cd blog.git \u0026#x26;\u0026#x26; git init --bare\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git clone git@gitlab.com:nindalf/blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ cd blog\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git remote add vps root@141.48.83.111:blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git remote add all git@gitlab.com:nindalf/blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git remote set-url --add --push all root@141.48.83.111:blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git remote set-url --add --push all git@gitlab.com:nindalf/blog.git\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ekrishnasr@mbp $ git push all\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003ePull Git on server\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ git clone /root/blog.git/\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSet up post receive hook\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ cd /root/blog.git/hooks\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ vim post-receive\u003c/code\u003e and paste in the contents from \u003ca href=\"https://gist.github.com/nindalf/93a65fba4edbd04300cb318b707357da#file-post-receive\"\u003ehere\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eroot@prod $ bash post-receive\u003c/code\u003e - test that it's working correctly and generating the right output in the right folder\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSet up ufw.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eufw default deny incoming\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eufw default allow outgoing\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eufw allow ssh\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eufw allow 'Nginx Full'\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eufw enable\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eufw status\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eCheck result is identical to \u003ca href=\"https://gist.github.com/nindalf/93a65fba4edbd04300cb318b707357da#file-nginx-config-result-txt\"\u003ethis\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSet up nginx.\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eapt-get install nginx\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003evim /etc/nginx/sites-available/default\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eserver_name blog.nindalf.com nindalf.com www.nindalf.com\u003c/code\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003cli\u003eSet up certificates\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eadd-apt-repository ppa:certbot/certbot\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapt-get update\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eapt-get install python-certbot-nginx\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ecertbot --nginx -d blog.nindalf.com -d nindalf.com -d www.nindalf.com\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eFollow interactive tutorial\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003ch2\u003eMore context\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eSteps 1-4: \u003ca href=\"https://www.digitalocean.com/community/tutorials/how-to-deploy-a-hugo-site-to-production-with-git-hooks-on-ubuntu-14-04\"\u003elink\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eStep 5: \u003ca href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-16-04\"\u003elink\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003eStep 6-7: \u003ca href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-let-s-encrypt-with-nginx-server-blocks-on-ubuntu-16-04\"\u003elink\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eShoutout to the great tutorials on DigitalOcean!\u003c/p\u003e\n","preview":"This blog is generated by hugo, a static site generator. My flow is to write it markdown files on my laptop, commit it to a git repository and push it to the machine that's hosting the blog you're reading. Once the push is successful, a post-commit hook runs hugo and generates HTML pages. Nginx serves these pages.","title":"Setting up this blog","date":"2019-01-09","tags":["tech"]}},"__N_SSG":true},"page":"/posts/[id]","query":{"id":"setting-up-this-blog"},"buildId":"Jf-wop3a-jR8I9PxYMsgo","isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-8683bd742a84c1edd48c.js"></script><script src="/_next/static/chunks/webpack-18c200bfa4628d9da94c.js" async=""></script><script src="/_next/static/chunks/framework-5e33f488d9410ce9ba9d.js" async=""></script><script src="/_next/static/chunks/597-e9cbf8ad4e8557f256b3.js" async=""></script><script src="/_next/static/chunks/778-c9e86f308cd9cb372f22.js" async=""></script><script src="/_next/static/chunks/main-9ca82ec4d4aca520c43d.js" async=""></script><script src="/_next/static/chunks/pages/_app-33eebf5131cfd5d17810.js" async=""></script><script src="/_next/static/chunks/941-89b1c2f25315e4a44edb.js" async=""></script><script src="/_next/static/chunks/pages/posts/%5Bid%5D-4aeed08a217f27d1079a.js" async=""></script><script src="/_next/static/Jf-wop3a-jR8I9PxYMsgo/_buildManifest.js" async=""></script><script src="/_next/static/Jf-wop3a-jR8I9PxYMsgo/_ssgManifest.js" async=""></script><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "e957a0fd477941f5a9aa5fc4be0670df"}'></script></body></html>